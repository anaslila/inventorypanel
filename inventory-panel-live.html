<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Panel v 2.0 - Live Status</title>
    
    <!-- Previous CSS remains same, adding status styles -->
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --blocked-color: #e74c3c;
            --hold-color: #f39c12;
            --booked-color: #9b59b6;
            --available-color: #27ae60;
            /* ... rest of your CSS variables ... */
        }

        /* STATUS INDICATOR STYLES */
        .status-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .status-available {
            background: rgba(39, 174, 96, 0.9);
            color: white;
        }

        .status-blocked {
            background: rgba(231, 76, 60, 0.9);
            color: white;
        }

        .status-hold {
            background: rgba(243, 156, 18, 0.9);
            color: white;
        }

        .status-booked {
            background: rgba(155, 89, 182, 0.9);
            color: white;
        }

        /* STATUS FILTER */
        .status-filter {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .status-filter-btn {
            padding: 8px 15px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-primary);
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-filter-btn.active {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .status-filter-btn.filter-available.active {
            border-color: var(--available-color);
            background: rgba(39, 174, 96, 0.1);
            color: var(--available-color);
        }

        .status-filter-btn.filter-blocked.active {
            border-color: var(--blocked-color);
            background: rgba(231, 76, 60, 0.1);
            color: var(--blocked-color);
        }

        .status-filter-btn.filter-hold.active {
            border-color: var(--hold-color);
            background: rgba(243, 156, 18, 0.1);
            color: var(--hold-color);
        }

        .status-filter-btn.filter-booked.active {
            border-color: var(--booked-color);
            background: rgba(155, 89, 182, 0.1);
            color: var(--booked-color);
        }

        /* CARD OPACITY FOR NON-AVAILABLE */
        .flat-card.status-blocked,
        .flat-card.status-hold,
        .flat-card.status-booked {
            opacity: 0.8;
        }

        .flat-card.status-blocked {
            pointer-events: none;
        }

        /* LOADING INDICATOR */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: var(--text-secondary);
        }

        /* STATUS STATS */
        .status-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-stat {
            text-align: center;
            padding: 15px 10px;
            border-radius: 8px;
            background: var(--bg-secondary);
        }

        .status-stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .status-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* ... Rest of your existing CSS ... */
    </style>
</head>
<body>
    <div class="container">
        <!-- Your existing header -->
        <div class="header">
            <!-- Same as before -->
        </div>

        <!-- NAVIGATION with Status Filter -->
        <div class="nav-section">
            <!-- Your existing filters -->
            
            <!-- NEW: Status Filter -->
            <div class="status-filter">
                <button class="status-filter-btn filter-all active" onclick="filterByStatus('all')">
                    üìã All Status
                </button>
                <button class="status-filter-btn filter-available" onclick="filterByStatus('available')">
                    ‚úÖ Available
                </button>
                <button class="status-filter-btn filter-blocked" onclick="filterByStatus('blocked')">
                    üö´ Blocked
                </button>
                <button class="status-filter-btn filter-hold" onclick="filterByStatus('hold')">
                    ‚è≥ On Hold
                </button>
                <button class="status-filter-btn filter-booked" onclick="filterByStatus('booked')">
                    üè† Booked
                </button>
            </div>
        </div>

        <!-- STATUS STATS -->
        <div class="stats-section">
            <div class="stats-grid">
                <!-- Existing stats -->
                <div class="stat-card stat-1bhk">
                    <div class="stat-number" id="bhk1Count">0</div>
                    <div class="stat-label">1 BHK Units</div>
                </div>
                <div class="stat-card stat-2bhk">
                    <div class="stat-number" id="bhk2Count">0</div>
                    <div class="stat-label">2 BHK Units</div>
                </div>
            </div>
            
            <!-- NEW: Status Stats -->
            <div class="status-stats">
                <div class="status-stat">
                    <div class="status-stat-number" id="availableCount" style="color: var(--available-color);">0</div>
                    <div class="status-stat-label">Available</div>
                </div>
                <div class="status-stat">
                    <div class="status-stat-number" id="blockedCount" style="color: var(--blocked-color);">0</div>
                    <div class="status-stat-label">Blocked</div>
                </div>
                <div class="status-stat">
                    <div class="status-stat-number" id="holdCount" style="color: var(--hold-color);">0</div>
                    <div class="status-stat-label">On Hold</div>
                </div>
                <div class="status-stat">
                    <div class="status-stat-number" id="bookedCount" style="color: var(--booked-color);">0</div>
                    <div class="status-stat-label">Booked</div>
                </div>
            </div>
        </div>

        <!-- Rest of your existing HTML -->
        <div class="inventory-grid" id="inventoryGrid">
            <div class="loading">Loading live inventory data...</div>
        </div>

        <!-- Your existing modals and footer -->
    </div>

    <script>
        // GLOBAL VARIABLES
        let inventoryData = null;
        let allPropertyData = [];
        let displayedData = [];
        let currentStatusFilter = 'all';
        
        // LOAD DATA FROM JSON
        async function loadInventoryData() {
            try {
                const response = await fetch('inventory-data.json');
                inventoryData = await response.json();
                generateUnitsFromData();
                renderFlats(displayedData);
                updateAllStats();
            } catch (error) {
                console.error('Error loading inventory data:', error);
                document.getElementById('inventoryGrid').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--danger-color);">
                        <h3>‚ùå Error Loading Data</h3>
                        <p>Could not load inventory-data.json</p>
                        <p>Make sure the JSON file is in the same folder.</p>
                    </div>
                `;
            }
        }

        // GENERATE UNITS FROM JSON DATA
        function generateUnitsFromData() {
            allPropertyData = [];
            
            Object.keys(inventoryData.towers).forEach(towerName => {
                const tower = inventoryData.towers[towerName];
                
                for (let floor = 1; floor <= 35; floor++) {
                    for (let unit = 1; unit <= tower.units.length; unit++) {
                        let band = "1st Band";
                        let prices = tower.band1Prices;
                        
                        if (floor >= 6 && floor <= 23) {
                            band = "2nd Band";
                            prices = tower.band2Prices;
                        }
                        if (floor >= 24) {
                            band = "3rd Band";
                            prices = tower.band3Prices;
                        }
                        
                        const unitNumber = `${towerName.charAt(0)} ${floor}${unit.toString().padStart(2, '0')}`;
                        const status = inventoryData.inventoryStatus[unitNumber] || 'available';
                        
                        allPropertyData.push({
                            unitNumber: unitNumber,
                            floorNumber: floor.toString(),
                            band: band,
                            facing: unit <= Math.ceil(tower.units.length / 2) ? "East / SGNP" : "West /SIS",
                            carpetArea: tower.units[unit - 1],
                            typology: tower.types[unit - 1],
                            price: prices[unit - 1],
                            allInclusiveAmount: Math.floor(prices[unit - 1] * 1.2),
                            tower: towerName,
                            status: status
                        });
                    }
                }
            });
            
            displayedData = [...allPropertyData];
        }

        // FILTER BY STATUS
        function filterByStatus(status) {
            currentStatusFilter = status;
            
            // Update filter button states
            document.querySelectorAll('.status-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.filter-${status}`).classList.add('active');
            
            // Apply filter
            applyAllFilters();
        }

        // UPDATED FILTER FUNCTION
        function applyAllFilters() {
            const towerFilter = document.getElementById('towerFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const bandFilter = document.getElementById('bandFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const luckyNumber = parseInt(document.getElementById('numerologyInput').value) || 0;

            displayedData = allPropertyData.filter(flat => {
                const matchesTower = towerFilter === 'all' || flat.tower === towerFilter;
                const matchesType = typeFilter === 'all' || flat.typology === typeFilter;
                const matchesBand = bandFilter === 'all' || flat.band === bandFilter;
                const matchesStatus = currentStatusFilter === 'all' || flat.status === currentStatusFilter;
                const matchesSearch = searchTerm === '' || 
                    flat.unitNumber.toLowerCase().includes(searchTerm) ||
                    flat.price.toString().includes(searchTerm) ||
                    flat.carpetArea.toString().includes(searchTerm);
                const matchesNumerology = !luckyNumber || calculateNumerologySum(flat.unitNumber) === luckyNumber;

                return matchesTower && matchesType && matchesBand && matchesStatus && matchesSearch && matchesNumerology;
            });

            currentPage = 1;
            renderFlats(displayedData);
            updateAllStats();
        }

        // RENDER FLATS WITH STATUS
        function renderFlats(data) {
            const grid = document.getElementById('inventoryGrid');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = data.slice(startIndex, endIndex);
            
            if (pageData.length === 0) {
                grid.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary); font-size: 18px; grid-column: 1 / -1;">No properties found matching your criteria.</div>';
                return;
            }

            grid.innerHTML = pageData.map(flat => {
                const statusConfig = inventoryData.statusConfig[flat.status];
                const numerologySum = calculateNumerologySum(flat.unitNumber);
                
                return `
                <div class="flat-card ${getBandClass(flat.band)} status-${flat.status} clickable-card" onclick="openPaymentPlan('${flat.unitNumber}')">
                    <div class="status-badge status-${flat.status}">
                        ${statusConfig.icon} ${statusConfig.label}
                    </div>
                    
                    <div class="flat-header">
                        <div class="flat-number">${flat.unitNumber}</div>
                        <div class="flat-tower">${flat.tower}</div>
                    </div>
                    
                    <div class="flat-actions">
                        <button class="action-btn ${favorites.includes(flat.unitNumber) ? 'active' : ''}" onclick="event.stopPropagation(); toggleFavorite('${flat.unitNumber}')">
                            ${favorites.includes(flat.unitNumber) ? '‚ù§Ô∏è' : 'ü§ç'} Favorite
                        </button>
                        <button class="action-btn ${compareList.includes(flat.unitNumber) ? 'active' : ''}" onclick="event.stopPropagation(); toggleCompare('${flat.unitNumber}')">
                            ‚öñÔ∏è Compare
                        </button>
                    </div>
                    
                    <div class="flat-details">
                        <div class="detail-row">
                            <span class="detail-label">TYPE:</span>
                            <span class="detail-value typology">${flat.typology}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">FLOOR:</span>
                            <span class="detail-value">${flat.floorNumber}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">CARPET AREA:</span>
                            <span class="detail-value">${flat.carpetArea} sq ft</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">BAND:</span>
                            <span class="detail-value">${flat.band}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">STATUS:</span>
                            <span class="detail-value" style="color: ${statusConfig.color}; font-weight: bold;">
                                ${statusConfig.icon} ${statusConfig.label}
                            </span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">LUCKY NUMBER:</span>
                            <span class="detail-value" style="color: var(--warning-color); font-weight: bold;">${numerologySum}</span>
                        </div>
                        
                        <div class="price-row">
                            <div class="detail-row">
                                <span class="detail-label">BASE PRICE:</span>
                                <span class="detail-value price">${formatPrice(flat.price)}</span>
                            </div>
                            <div class="detail-row" style="margin-bottom: 0;">
                                <span class="detail-label">ALL INCLUSIVE:</span>
                                <span class="detail-value price">${formatPrice(flat.allInclusiveAmount)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px; font-size: 12px; color: var(--text-secondary);">
                        ${flat.status === 'available' ? 'üëÜ Click for Payment Plan Details' : flat.status === 'blocked' ? '‚ùå Unit Not Available' : '‚è≥ Contact for Details'}
                    </div>
                </div>
            `;
            }).join('');

            renderPagination(data.length);
        }

        // UPDATE ALL STATS
        function updateAllStats() {
            // BHK Stats
            const bhk1 = displayedData.filter(f => f.typology === '1BHK').length;
            const bhk2 = displayedData.filter(f => f.typology === '2BHK').length;
            document.getElementById('bhk1Count').textContent = bhk1;
            document.getElementById('bhk2Count').textContent = bhk2;

            // Status Stats
            const available = allPropertyData.filter(f => f.status === 'available').length;
            const blocked = allPropertyData.filter(f => f.status === 'blocked').length;
            const hold = allPropertyData.filter(f => f.status === 'hold').length;
            const booked = allPropertyData.filter(f => f.status === 'booked').length;

            document.getElementById('availableCount').textContent = available;
            document.getElementById('blockedCount').textContent = blocked;
            document.getElementById('holdCount').textContent = hold;
            document.getElementById('bookedCount').textContent = booked;
        }

        // ADD YOUR EXISTING FUNCTIONS HERE
        // (calculateNumerologySum, formatPrice, getBandClass, etc.)
        
        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', function() {
            loadInventoryData();
            updateCounts();
        });

        // REST OF YOUR EXISTING JAVASCRIPT CODE...
    </script>
</body>
</html>
